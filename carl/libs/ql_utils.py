import gymnasium as gym
import math
import random
# import matplotlib
# import matplotlib.pyplot as plt
from collections import namedtuple, deque
from itertools import count
import os
import shutil
import ipdb

import torch
import torch.nn as nn
import torch.optim as optim
import torch.nn.functional as F

NEW_BRANCHES = ['centerpoint_dyn_pillar024_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar040_4x',
            'centerpoint_dyn_pillar044_4x',
            'centerpoint_dyn_pillar048_4x',
            'centerpoint_dyn_pillar052_4x',
            'centerpoint_without_resnet_dyn_voxel100',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel250',
            'centerpoint_without_resnet_dyn_voxel300',
            'centerpoint_without_resnet_dyn_voxel350',
            'centerpoint_without_resnet_dyn_voxel400',
            'centerpoint_without_resnet_dyn_voxel450',
            'dsvt_sampled_pillar020',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_pillar100',
            'dsvt_sampled_pillar110',
            'dsvt_sampled_pillar120',
            'dsvt_sampled_pillar130',
            'dsvt_sampled_voxel020',
            'dsvt_sampled_voxel030',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel060',
            'dsvt_sampled_voxel070',
            'dsvt_sampled_voxel080',
            'dsvt_sampled_voxel090',
            'dsvt_sampled_voxel100',
            'dsvt_sampled_voxel110',
            'dsvt_sampled_voxel120',
            'dsvt_sampled_voxel130']

FILTER_HIGH_LATENCY_BRANCHES = ['centerpoint_dyn_pillar024_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar040_4x',
            'centerpoint_dyn_pillar044_4x',
            'centerpoint_dyn_pillar048_4x',
            'centerpoint_dyn_pillar052_4x',
            'centerpoint_without_resnet_dyn_voxel100',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel250',
            'centerpoint_without_resnet_dyn_voxel300',
            'centerpoint_without_resnet_dyn_voxel350',
            'centerpoint_without_resnet_dyn_voxel400',
            'centerpoint_without_resnet_dyn_voxel450',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_pillar100',
            'dsvt_sampled_pillar110',
            'dsvt_sampled_pillar120',
            'dsvt_sampled_pillar130',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel060',
            'dsvt_sampled_voxel070',
            'dsvt_sampled_voxel080',
            'dsvt_sampled_voxel090',
            'dsvt_sampled_voxel100',
            'dsvt_sampled_voxel110',
            'dsvt_sampled_voxel120',
            'dsvt_sampled_voxel130']

PARETO_FRONTIER_BRANCHES = ['centerpoint_dyn_pillar024_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar040_4x',
            'centerpoint_dyn_pillar044_4x',
            'centerpoint_dyn_pillar052_4x',
            'centerpoint_without_resnet_dyn_voxel100',
            'centerpoint_without_resnet_dyn_voxel150',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel060']

ENLARGE79 = ['centerpoint_dyn_pillar024_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar040_4x',
            'centerpoint_dyn_pillar044_4x',
            'centerpoint_dyn_pillar048_4x',
            'centerpoint_dyn_pillar052_4x',
            'centerpoint_without_resnet_dyn_voxel100',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel250',
            'centerpoint_without_resnet_dyn_voxel300',
            'centerpoint_without_resnet_dyn_voxel350',
            'centerpoint_without_resnet_dyn_voxel400',
            'centerpoint_without_resnet_dyn_voxel450',
            'dsvt_sampled_pillar020',
            'dsvt_sampled_pillar022',
            'dsvt_sampled_pillar024',
            'dsvt_sampled_pillar026',
            'dsvt_sampled_pillar028',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar032',
            'dsvt_sampled_pillar034',
            'dsvt_sampled_pillar036',
            'dsvt_sampled_pillar038',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar042',
            'dsvt_sampled_pillar044',
            'dsvt_sampled_pillar046',
            'dsvt_sampled_pillar048',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar052',
            'dsvt_sampled_pillar054',
            'dsvt_sampled_pillar056',
            'dsvt_sampled_pillar058',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar066',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar076',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar086',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_pillar100',
            'dsvt_sampled_pillar110',
            'dsvt_sampled_pillar120',
            'dsvt_sampled_pillar130',
            'dsvt_sampled_voxel020',
            'dsvt_sampled_voxel022',
            'dsvt_sampled_voxel024',
            'dsvt_sampled_voxel026',
            'dsvt_sampled_voxel028',
            'dsvt_sampled_voxel030',
            'dsvt_sampled_voxel032',
            'dsvt_sampled_voxel034',
            'dsvt_sampled_voxel036',
            'dsvt_sampled_voxel038',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel042',
            'dsvt_sampled_voxel044',
            'dsvt_sampled_voxel046',
            'dsvt_sampled_voxel048',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel052',
            'dsvt_sampled_voxel054',
            'dsvt_sampled_voxel056',
            'dsvt_sampled_voxel058',
            'dsvt_sampled_voxel060',
            'dsvt_sampled_voxel062',
            'dsvt_sampled_voxel064',
            'dsvt_sampled_voxel066',
            'dsvt_sampled_voxel068',
            'dsvt_sampled_voxel070',
            'dsvt_sampled_voxel080',
            'dsvt_sampled_voxel090',
            'dsvt_sampled_voxel100',
            'dsvt_sampled_voxel110',
            'dsvt_sampled_voxel120',
            'dsvt_sampled_voxel130']

ENLARGE82 = ['centerpoint_dyn_pillar024_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar040_4x',
            'centerpoint_dyn_pillar044_4x',
            'centerpoint_dyn_pillar048_4x',
            'centerpoint_dyn_pillar052_4x',
            'centerpoint_without_resnet_dyn_voxel100',
            'centerpoint_without_resnet_dyn_voxel110',
            'centerpoint_without_resnet_dyn_voxel120',
            'centerpoint_without_resnet_dyn_voxel125',
            'centerpoint_without_resnet_dyn_voxel130',
            'centerpoint_without_resnet_dyn_voxel140',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel250',
            'centerpoint_without_resnet_dyn_voxel300',
            'centerpoint_without_resnet_dyn_voxel350',
            'dsvt_sampled_pillar020',
            'dsvt_sampled_pillar022',
            'dsvt_sampled_pillar024',
            'dsvt_sampled_pillar026',
            'dsvt_sampled_pillar028',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar032',
            'dsvt_sampled_pillar034',
            'dsvt_sampled_pillar036',
            'dsvt_sampled_pillar038',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar042',
            'dsvt_sampled_pillar044',
            'dsvt_sampled_pillar046',
            'dsvt_sampled_pillar048',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar052',
            'dsvt_sampled_pillar054',
            'dsvt_sampled_pillar056',
            'dsvt_sampled_pillar058',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar066',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar076',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar086',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_pillar100',
            'dsvt_sampled_pillar110',
            'dsvt_sampled_pillar120',
            'dsvt_sampled_pillar130',
            'dsvt_sampled_voxel020',
            'dsvt_sampled_voxel022',
            'dsvt_sampled_voxel024',
            'dsvt_sampled_voxel026',
            'dsvt_sampled_voxel028',
            'dsvt_sampled_voxel030',
            'dsvt_sampled_voxel032',
            'dsvt_sampled_voxel034',
            'dsvt_sampled_voxel036',
            'dsvt_sampled_voxel038',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel042',
            'dsvt_sampled_voxel044',
            'dsvt_sampled_voxel046',
            'dsvt_sampled_voxel048',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel052',
            'dsvt_sampled_voxel054',
            'dsvt_sampled_voxel056',
            'dsvt_sampled_voxel058',
            'dsvt_sampled_voxel060',
            'dsvt_sampled_voxel062',
            'dsvt_sampled_voxel064',
            'dsvt_sampled_voxel066',
            'dsvt_sampled_voxel068',
            'dsvt_sampled_voxel070',
            'dsvt_sampled_voxel080',
            'dsvt_sampled_voxel090',
            'dsvt_sampled_voxel100',
            'dsvt_sampled_voxel110',
            'dsvt_sampled_voxel120',
            'dsvt_sampled_voxel130']

CONTENTION55 = ['centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar024_4x',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel140',
            'centerpoint_without_resnet_dyn_voxel130',
            'centerpoint_without_resnet_dyn_voxel125',
            'centerpoint_without_resnet_dyn_voxel120',
            'centerpoint_without_resnet_dyn_voxel110',
            'centerpoint_without_resnet_dyn_voxel100',
            'dsvt_sampled_pillar090',
            'dsvt_sampled_pillar086',
            'dsvt_sampled_pillar080',
            'dsvt_sampled_pillar076',
            'dsvt_sampled_pillar070',
            'dsvt_sampled_pillar066',
            'dsvt_sampled_pillar060',
            'dsvt_sampled_pillar058',
            'dsvt_sampled_pillar056',
            'dsvt_sampled_pillar054',
            'dsvt_sampled_pillar052',
            'dsvt_sampled_pillar050',
            'dsvt_sampled_pillar048',
            'dsvt_sampled_pillar046',
            'dsvt_sampled_pillar044',
            'dsvt_sampled_pillar042',
            'dsvt_sampled_pillar040',
            'dsvt_sampled_pillar038',
            'dsvt_sampled_pillar036',
            'dsvt_sampled_pillar034',
            'dsvt_sampled_pillar032',
            'dsvt_sampled_pillar030',
            'dsvt_sampled_pillar028',
            'dsvt_sampled_voxel090',
            'dsvt_sampled_voxel080',
            'dsvt_sampled_voxel070',
            'dsvt_sampled_voxel068',
            'dsvt_sampled_voxel066',
            'dsvt_sampled_voxel064',
            'dsvt_sampled_voxel062',
            'dsvt_sampled_voxel060',
            'dsvt_sampled_voxel058',
            'dsvt_sampled_voxel056',
            'dsvt_sampled_voxel054',
            'dsvt_sampled_voxel052',
            'dsvt_sampled_voxel050',
            'dsvt_sampled_voxel048',
            'dsvt_sampled_voxel046',
            'dsvt_sampled_voxel044',
            'dsvt_sampled_voxel042',
            'dsvt_sampled_voxel040',
            'dsvt_sampled_voxel038',
            'dsvt_sampled_voxel036']

CONTENTION12 = ['centerpoint_dyn_pillar036_4x',
            'centerpoint_dyn_pillar032_4x',
            'centerpoint_dyn_pillar028_4x',
            'centerpoint_dyn_pillar024_4x',
            'centerpoint_without_resnet_dyn_voxel200',
            'centerpoint_without_resnet_dyn_voxel150',
            'centerpoint_without_resnet_dyn_voxel140',
            'centerpoint_without_resnet_dyn_voxel130',
            'centerpoint_without_resnet_dyn_voxel125',
            'centerpoint_without_resnet_dyn_voxel120',
            'centerpoint_without_resnet_dyn_voxel110',
            'centerpoint_without_resnet_dyn_voxel100']
